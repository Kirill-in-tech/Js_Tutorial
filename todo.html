<!DOCTYPE html>
	<html>
		<head>
			<title>Kirill's Todo List</title>
		</head>

	<body>
		<input id="todo-title" type="text" placeholder="add your todo"/>
		<input id="date-picker" type="date" />
    <button onclick="addTodo();">Add Todo</button>
		<br><br>
		<div id="todo-list"></div>
		
		
		<script>
      // Model Section
      let todos = [{
        title: 'Get groceries',
        dueDate: '2000-01-01',
        id: 'id1',
        isDone: false
      }, {
        title: 'Wash car',
        dueDate: '2000-01-02',
        id: 'id2',
        isDone: false
      }, {
        title: 'Make dinner',
        dueDate: '2000-01-03',
        id: 'id3',
        isDone: false
      }, {
        title: 'Do laundry',
        dueDate: '2000-01-04',
        id: 'id4',
        isDone: false
      }];

      // Creates a todo
      const createTodo = (title, dueDate) => {
        const id = '' + new Date().getTime();
        todos.push({
          title: title,
          dueDate: dueDate,
          id: id,
          isDone: false
        });
        // saveTodo();
      }

      // Deletes a todo
      const removeTodo = idToDelete => {

        todos = todos.filter(todo => {
          return todo.id !== idToDelete;
        });
        // saveTodo();
      }

      // Saves a todo
      const saveTodo = () => {
        localStorage.setItem('todos', JSON.stringify(todos));
      }

      // Toggles todo
      const toggleTodo = (id, status) => {
        todos.forEach (todo => {
          if (todo.id === id) {
            todo.isDone = status;
          }
        });
      }

      // View Section
			const addElement = () => {
				// reset our todo-list
				document.getElementById('todo-list').innerHTML ='';

				todos.forEach (todo => {
          const element = document.createElement('div');
          element.innerText = todo.title + ' ' + todo.dueDate;

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.style = 'margin-right: 5px';
          checkbox.id = todo.id;  
          checkbox.onchange = checkTodo;
          if (todo.isDone === true) 
            checkbox.checked = true;
          else 
            checkbox.checked = false;          
          element.prepend(checkbox);

          const deleteButton = document.createElement('button');
          deleteButton.innerText = 'Delete';
          deleteButton.style = 'margin-left: 10px';
          deleteButton.onclick = deleteTodo(todo);          
          element.append(deleteButton);

          const todoList = document.getElementById('todo-list');
          todoList.appendChild(element);
			  });
			}

      // Controller Section
			const addTodo = () => {
				const textbox = document.getElementById('todo-title');
				const title = textbox.value;

        const datePicker = document.getElementById('date-picker');
        const dueDate = datePicker.value;

        createTodo(title, dueDate);
				addElement();
			}

      // the example of closure
      const deleteTodo = todoToDelete => {
        return () => {
          removeTodo(todoToDelete.id);
          addElement();
        } 
      }

      const checkTodo = event => {
        const checkbox = event.target;
        const idToCheck = checkbox.id;
        const checkedStatus = checkbox.checked;

        toggleTodo(idToCheck, checkedStatus);
        addElement();
      }

      // const deleteTodo = (event) => {
      //   const delButton = event.target;
      //   const idToDelete = delButton.id

      //   removeTodo(idToDelete);
      //   addElement();
      // }


      // Main code
      window.onload = addElement();


		</script>
	</body>
</html>